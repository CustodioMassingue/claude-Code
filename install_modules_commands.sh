#!/bin/bash
# Comandos para instalar os módulos no servidor Odoo

echo "=========================================="
echo "INSTALAÇÃO DOS MÓDULOS DE CONTABILIDADE"
echo "=========================================="

# Configurações
ODOO_PATH="/opt/odoo"
ADDONS_PATH="/opt/odoo/custom-addons"

# 1. PRIMEIRO: Instalar módulo simples (teste)
echo ""
echo "1. MÓDULO SIMPLES (mz_accounting_dashboard)"
echo "-------------------------------------------"
echo "Este módulo é mais simples e serve para testar a instalação"
echo ""
echo "No servidor, execute:"
echo ""
echo "# Criar diretório se não existir"
echo "sudo mkdir -p $ADDONS_PATH"
echo ""
echo "# Copiar módulo (ajuste o caminho conforme necessário)"
echo "sudo cp -r /caminho/para/mz_accounting_dashboard $ADDONS_PATH/"
echo ""
echo "# Ajustar permissões"
echo "sudo chown -R odoo:odoo $ADDONS_PATH/mz_accounting_dashboard"
echo "sudo chmod -R 755 $ADDONS_PATH/mz_accounting_dashboard"
echo ""
echo "# Reiniciar Odoo com update do módulo"
echo "sudo systemctl stop odoo"
echo "sudo -u odoo $ODOO_PATH/odoo-bin -c /etc/odoo/odoo.conf -d SEU_DATABASE -u mz_accounting_dashboard --stop-after-init"
echo "sudo systemctl start odoo"
echo ""
echo "# OU apenas reiniciar o serviço"
echo "sudo systemctl restart odoo"
echo ""

# 2. DEPOIS: Instalar módulo completo
echo ""
echo "2. MÓDULO COMPLETO (mozambique_accounting)"
echo "-------------------------------------------"
echo "Instalar após confirmar que o simples funciona"
echo ""
echo "# Copiar módulo"
echo "sudo cp -r /caminho/para/mozambique_accounting $ADDONS_PATH/"
echo ""
echo "# Ajustar permissões"
echo "sudo chown -R odoo:odoo $ADDONS_PATH/mozambique_accounting"
echo "sudo chmod -R 755 $ADDONS_PATH/mozambique_accounting"
echo ""
echo "# Reiniciar Odoo"
echo "sudo systemctl restart odoo"
echo ""

# 3. Interface Web
echo ""
echo "3. NA INTERFACE WEB DO ODOO"
echo "-------------------------------------------"
echo "1. Acesse: http://SEU_IP:8069"
echo "2. Faça login como administrador"
echo "3. Ative o modo desenvolvedor:"
echo "   Settings > Developer Tools > Activate Developer Mode"
echo "4. Vá para Apps"
echo "5. Clique em 'Update Apps List'"
echo "6. Remova o filtro 'Apps' para ver todos os módulos"
echo "7. Procure por:"
echo "   - 'MZ Accounting Dashboard' (módulo simples)"
echo "   - 'Mozambique Accounting' (módulo completo)"
echo "8. Clique em Install"
echo ""

# 4. Verificação
echo ""
echo "4. VERIFICAÇÃO E TROUBLESHOOTING"
echo "-------------------------------------------"
echo "# Ver logs do Odoo"
echo "sudo tail -f /var/log/odoo/odoo.log"
echo ""
echo "# Verificar status do serviço"
echo "sudo systemctl status odoo"
echo ""
echo "# Verificar se os módulos estão no path"
echo "ls -la $ADDONS_PATH/"
echo ""
echo "# Testar carregamento do módulo diretamente"
echo "sudo -u odoo $ODOO_PATH/odoo-bin -c /etc/odoo/odoo.conf --test-enable --stop-after-init -i mz_accounting_dashboard"
echo ""

# 5. Rollback
echo ""
echo "5. ROLLBACK (se necessário)"
echo "-------------------------------------------"
echo "# Desinstalar módulo pela interface"
echo "Apps > Módulo > Uninstall"
echo ""
echo "# OU remover fisicamente"
echo "sudo rm -rf $ADDONS_PATH/mz_accounting_dashboard"
echo "sudo rm -rf $ADDONS_PATH/mozambique_accounting"
echo "sudo systemctl restart odoo"
echo ""

echo "=========================================="
echo "FIM DAS INSTRUÇÕES"
echo "=========================================="