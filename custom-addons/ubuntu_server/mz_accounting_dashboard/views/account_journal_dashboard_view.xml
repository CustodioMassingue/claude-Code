<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Account Journal Dashboard Kanban View -->
    <record id="account_journal_dashboard_kanban_view" model="ir.ui.view">
        <field name="name">account.journal.dashboard.kanban</field>
        <field name="model">account.journal</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_dashboard o_account_kanban o_kanban_mobile" 
                    create="false" 
                    sample="0">
                <field name="id"/>
                <field name="name"/>
                <field name="type"/>
                <field name="color"/>
                <field name="kanban_dashboard"/>
                <field name="kanban_dashboard_graph"/>
                <field name="show_on_dashboard"/>
                <field name="currency_id"/>
                <field name="company_id"/>
                
                <templates>
                    <t t-name="card">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click">
                            <t t-set="dashboard" t-value="record.kanban_dashboard.raw_value ? JSON.parse(record.kanban_dashboard.raw_value) : {}"/>
                            
                            <!-- Card Header -->
                            <div class="o_kanban_card_header">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_primary">
                                        <strong><field name="name"/></strong>
                                    </div>
                                    <div class="o_secondary">
                                        <span t-if="dashboard.bank_account" class="text-muted small">
                                            <t t-esc="dashboard.bank_account"/>
                                        </span>
                                    </div>
                                </div>
                                <div class="o_kanban_manage_button_section">
                                    <a class="o_kanban_manage_toggle_button" href="#">
                                        <i class="fa fa-ellipsis-v" aria-label="Manage" title="Manage"/>
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Card Content based on Journal Type -->
                            <div class="container o_kanban_card_content">
                                
                                <!-- Sales Journal -->
                                <t t-if="record.type.raw_value == 'sale'">
                                    <div class="row mb-2" t-if="dashboard.number_draft">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_draft"/> Draft
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-muted" t-esc="dashboard.sum_draft"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_to_send">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-warning" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_to_send"/> To Send
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-muted" t-esc="dashboard.sum_to_send"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_overdue">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-danger" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_overdue"/> Overdue
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-danger" t-esc="dashboard.sum_overdue"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_to_check">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-info" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_to_check"/> To Check
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-muted" t-esc="dashboard.sum_to_check"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mt-3 border-top pt-2">
                                        <div class="col-12">
                                            <small class="text-muted">This Month: <strong t-esc="dashboard.this_month_total"/></small>
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- Purchase Journal -->
                                <t t-if="record.type.raw_value == 'purchase'">
                                    <div class="row mb-2" t-if="dashboard.number_draft">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_draft"/> Draft
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-muted" t-esc="dashboard.sum_draft"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_to_pay">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-warning" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_to_pay"/> To Pay
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-warning" t-esc="dashboard.sum_to_pay"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_late">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-danger" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_late"/> Late
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-danger" t-esc="dashboard.sum_late"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_to_approve">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-info" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_to_approve"/> To Approve
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="text-muted" t-esc="dashboard.sum_to_approve"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mt-3 border-top pt-2">
                                        <div class="col-12">
                                            <small class="text-muted">This Month: <strong t-esc="dashboard.this_month_total"/></small>
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- Bank Journal -->
                                <t t-if="record.type.raw_value == 'bank'">
                                    <div class="row mb-3">
                                        <div class="col-12 text-center">
                                            <h4 class="mb-0">
                                                <strong t-esc="dashboard.balance"/>
                                            </h4>
                                            <small class="text-muted">Current Balance</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <small class="text-muted">Last Sync:</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <small t-esc="dashboard.last_sync"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.to_reconcile">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-warning" name="action_open_reconcile" type="object">
                                                To Reconcile
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="badge rounded-pill text-bg-warning" t-esc="dashboard.to_reconcile"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.outstanding_receipts_count">
                                        <div class="col-6">
                                            <small class="text-success">Outstanding Receipts</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <small class="text-success" t-esc="dashboard.outstanding_receipts_total"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.outstanding_payments_count">
                                        <div class="col-6">
                                            <small class="text-danger">Outstanding Payments</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <small class="text-danger" t-esc="dashboard.outstanding_payments_total"/>
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- Cash Journal -->
                                <t t-if="record.type.raw_value == 'cash'">
                                    <div class="row mb-3">
                                        <div class="col-12 text-center">
                                            <h4 class="mb-0">
                                                <strong t-esc="dashboard.balance"/>
                                            </h4>
                                            <small class="text-muted">Current Balance</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <small class="text-success">Cash In Today</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <small class="text-success" t-esc="dashboard.cash_in_today"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <small class="text-danger">Cash Out Today</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <small class="text-danger" t-esc="dashboard.cash_out_today"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_draft">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start" name="action_view_all" type="object">
                                                <span t-esc="dashboard.number_draft"/> Pending
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="badge rounded-pill text-bg-secondary" t-esc="dashboard.today_transactions"/> Today
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- General Journal -->
                                <t t-if="record.type.raw_value == 'general'">
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start" name="action_view_entries" type="object">
                                                <span t-esc="dashboard.number_draft or 0"/> Draft Entries
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <span class="text-muted">Posted This Month</span>
                                        </div>
                                        <div class="col-6 text-end">
                                            <strong t-esc="dashboard.entries_this_month or 0"/>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-2" t-if="dashboard.number_to_review">
                                        <div class="col-6">
                                            <button class="btn btn-link p-0 text-start text-info" name="action_view_entries" type="object">
                                                To Review
                                            </button>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span class="badge rounded-pill text-bg-info" t-esc="dashboard.number_to_review"/>
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- Graph placeholder for sales/purchase journals -->
                                <t t-if="record.type.raw_value in ['sale', 'purchase']">
                                    <div class="o_kanban_graph_section mt-3 pt-3 border-top">
                                        <field name="kanban_dashboard_graph" widget="mz_dashboard_graph"/>
                                    </div>
                                </t>
                            </div>
                            
                            <!-- Card Footer Actions -->
                            <div class="o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <div class="o_kanban_card_manage_section o_kanban_manage_view">
                                    <h5>View</h5>
                                    <div>
                                        <a name="action_view_all" type="object">
                                            <t t-if="record.type.raw_value == 'sale'">Customer Invoices</t>
                                            <t t-elif="record.type.raw_value == 'purchase'">Vendor Bills</t>
                                            <t t-elif="record.type.raw_value == 'bank'">Bank Transactions</t>
                                            <t t-elif="record.type.raw_value == 'cash'">Cash Transactions</t>
                                            <t t-else="">Journal Entries</t>
                                        </a>
                                    </div>
                                    <div t-if="record.type.raw_value in ['sale', 'purchase']">
                                        <a name="action_view_all" type="object" context="{'search_default_draft': 1}">
                                            Draft Entries
                                        </a>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_card_manage_section o_kanban_manage_new">
                                    <h5>New</h5>
                                    <div>
                                        <a name="action_create_new" type="object">
                                            <t t-if="record.type.raw_value == 'sale'">Invoice</t>
                                            <t t-elif="record.type.raw_value == 'purchase'">Bill</t>
                                            <t t-elif="record.type.raw_value in ['bank', 'cash']">Payment</t>
                                            <t t-else="">Journal Entry</t>
                                        </a>
                                    </div>
                                    <div t-if="record.type.raw_value == 'sale'">
                                        <a name="action_create_new" type="object" context="{'default_move_type': 'out_refund'}">
                                            Credit Note
                                        </a>
                                    </div>
                                    <div t-if="record.type.raw_value == 'purchase'">
                                        <a name="action_upload_document" type="object">
                                            Upload Document
                                        </a>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_card_manage_section o_kanban_manage_operations" t-if="record.type.raw_value in ['bank', 'cash']">
                                    <h5>Operations</h5>
                                    <div>
                                        <a name="action_open_reconcile" type="object">Reconcile</a>
                                    </div>
                                    <div t-if="record.type.raw_value == 'bank'">
                                        <a name="action_view_all" type="object">Import Statement</a>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_card_manage_section o_kanban_manage_settings">
                                    <h5>Configuration</h5>
                                    <div>
                                        <a name="action_configure_journal" type="object">Journal Settings</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Search View for Dashboard -->
    <record id="view_account_journal_dashboard_search" model="ir.ui.view">
        <field name="name">account.journal.dashboard.search</field>
        <field name="model">account.journal</field>
        <field name="arch" type="xml">
            <search string="Journals">
                <field name="name" string="Journal"/>
                <field name="type"/>
                <filter string="Sales" name="sales" domain="[('type', '=', 'sale')]"/>
                <filter string="Purchases" name="purchases" domain="[('type', '=', 'purchase')]"/>
                <filter string="Bank" name="bank" domain="[('type', '=', 'bank')]"/>
                <filter string="Cash" name="cash" domain="[('type', '=', 'cash')]"/>
                <filter string="Miscellaneous" name="general" domain="[('type', '=', 'general')]"/>
                <separator/>
                <filter string="Favorited" name="favorites" domain="[('show_on_dashboard', '=', True)]"/>
                <group expand="0" string="Group By">
                    <filter string="Type" name="group_by_type" domain="[]" context="{'group_by': 'type'}"/>
                    <filter string="Company" name="group_by_company" domain="[]" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Dashboard Action - Simple Version -->
    <record id="action_mz_dashboard_simple" model="ir.actions.act_window">
        <field name="name">MZ Dashboard</field>
        <field name="res_model">account.journal</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_id" ref="account_journal_dashboard_kanban_view"/>
        <field name="search_view_id" ref="view_account_journal_dashboard_search"/>
        <field name="domain">[('show_on_dashboard', '=', True)]</field>
        <field name="context">{'search_default_favorites': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No accounting journals found
            </p>
            <p>
                Create journals in the configuration menu to start managing your accounting.
            </p>
        </field>
    </record>
    
    <!-- Main Dashboard Menu - Root Menu -->
    <menuitem 
        id="menu_mz_dashboard_root"
        name="MZ Accounting"
        sequence="50"
        web_icon="mz_accounting_dashboard,static/description/icon.png"
        groups="base.group_user"/>
    
    <!-- Dashboard Menu Item -->
    <menuitem 
        id="menu_mz_dashboard_main"
        name="Dashboard"
        parent="menu_mz_dashboard_root"
        action="action_mz_dashboard_simple"
        sequence="10"
        groups="base.group_user"/>
    
    <!-- Also add to existing Accounting menu if available -->
    <menuitem 
        id="menu_mz_dashboard_accounting"
        name="MZ Dashboard"
        parent="account.menu_finance"
        action="action_mz_dashboard_simple"
        sequence="1"
        groups="account.group_account_readonly"/>
</odoo>